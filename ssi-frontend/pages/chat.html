<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat | SSI App</title>
  <link rel="icon" href="data:," />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script>
    (function () {
      var v = String(Date.now());
      window.__ssiAssetVersion = v;
      var localStyle = document.createElement("link");
      localStyle.rel = "stylesheet";
      localStyle.href = "../css/styles.css?v=" + encodeURIComponent(v);
      document.head.appendChild(localStyle);
    })();
  </script>
</head>
<body class="chat-page">

<nav class="navbar border-bottom app-navbar">
  <div class="container-fluid app-navbar-inner">
    <div class="app-navbar-left">
      <button
        id="showSidebarBtn"
        class="btn btn-sm btn-outline-secondary app-navbar-sidebar-btn d-none"
        type="button"
        aria-label="Open sidebar"
        title="Open sidebar"
      >
        <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" focusable="false">
          <rect x="3" y="4" width="18" height="16" rx="2" fill="none" stroke="currentColor" stroke-width="1.8"></rect>
          <line x1="9" y1="4.8" x2="9" y2="19.2" stroke="currentColor" stroke-width="1.8"></line>
          <line x1="12.5" y1="9" x2="18.5" y2="9" stroke="currentColor" stroke-width="1.8"></line>
          <line x1="12.5" y1="12" x2="18.5" y2="12" stroke="currentColor" stroke-width="1.8"></line>
          <line x1="12.5" y1="15" x2="18.5" y2="15" stroke="currentColor" stroke-width="1.8"></line>
        </svg>
      </button>
      <div class="navbar-brand mb-0 app-brand app-brand-chat">
        <div class="app-brand-title">SurgiNurse AI</div>
        <div class="app-brand-subtitle">Interactive training environment for surgical nurses on infection prevention in the surgical field</div>
      </div>
    </div>
    <button class="btn btn-outline-danger btn-sm" id="logoutBtn">Logout</button>
  </div>
</nav>

<div class="container-fluid app-chat-layout">
  <div class="app-chat-shell">

    <aside id="leftSidebar" class="border-end p-3 overflow-auto app-sidebar">
      <div class="d-grid gap-2 mb-3">
        <button id="newChatBtn" class="btn btn-primary">+ New Chat</button>
        <a id="adminNavLink" class="btn btn-outline-warning btn-sm d-none" href="admin.html">Admin - Knowledge Sources</a>
        <button id="hideSidebarBtn" class="btn btn-outline-secondary btn-sm">Hide sidebar</button>
      </div>

      <div class="d-flex gap-2 mb-3">
        <button id="showChatsTabBtn" class="btn btn-sm btn-primary flex-fill">Chats</button>
        <button id="showAnalyticsTabBtn" class="btn btn-sm btn-outline-secondary flex-fill">Analytics</button>
        <button id="showSettingsTabBtn" class="btn btn-sm btn-outline-secondary flex-fill">Settings</button>
      </div>

      <section id="chatsPanel">
        <div id="chatList" class="list-group"></div>
      </section>

      <section id="settingsPanel" class="d-none">
        <div class="card settings-card">
          <div class="card-body">
            <div class="small text-muted settings-title">Appearance</div>

            <div class="settings-row">
              <div class="settings-row-meta">
                <span class="small fw-semibold">Dark theme</span>
              </div>
              <label class="theme-switch" for="themeToggle">
                <input id="themeToggle" type="checkbox" />
                <span class="theme-slider"></span>
              </label>
            </div>

            <div class="settings-row">
              <div class="settings-row-meta">
                <span class="small fw-semibold">Language</span>
                <span id="languageCurrentLabel" class="settings-hint">English</span>
              </div>
              <label class="theme-switch language-switch" for="languageToggle">
                <input id="languageToggle" type="checkbox" />
                <span class="theme-slider" data-off="EN" data-on="GR"></span>
              </label>
            </div>
          </div>
        </div>
      </section>

      <section id="analyticsPanel" class="d-none">
        <div class="analytics-shell">
          <div class="analytics-head">
            <div>
              <div class="analytics-title">Learning Analytics</div>
              <div class="analytics-subtitle">Track quiz performance and study retention</div>
            </div>
            <button id="refreshAnalyticsBtn" class="btn btn-sm btn-outline-secondary" type="button">Refresh</button>
          </div>

          <div id="analyticsSignal" class="analytics-signal">
            <div class="analytics-signal-label">Learning signal</div>
            <div id="analyticsSignalTitle" class="analytics-signal-title">Collecting data</div>
            <div id="analyticsSignalHint" class="analytics-signal-hint">Complete a few quizzes to reveal trend quality.</div>
          </div>

          <div class="analytics-kpis">
            <div class="analytics-kpi">
              <div class="analytics-kpi-label">Total quizzes</div>
              <div id="kpiTotalQuizzes" class="analytics-kpi-value">0</div>
            </div>
            <div class="analytics-kpi">
              <div class="analytics-kpi-label">Average score</div>
              <div id="kpiAvgScore" class="analytics-kpi-value">-</div>
            </div>
            <div class="analytics-kpi">
              <div class="analytics-kpi-label">Last score</div>
              <div id="kpiLastScore" class="analytics-kpi-value">-</div>
            </div>
            <div class="analytics-kpi">
              <div class="analytics-kpi-label">Last 10 accuracy</div>
              <div id="kpiLast10" class="analytics-kpi-value">-</div>
            </div>
          </div>

          <div class="analytics-block">
            <div class="analytics-block-title">Score trend</div>
            <div id="analyticsTrendChart" class="analytics-trend-chart"></div>
          </div>

          <div class="analytics-block">
            <div class="analytics-block-title">Recent quizzes</div>
            <div id="analyticsHistoryList" class="analytics-history-list"></div>
          </div>

          <div class="analytics-block">
            <div class="analytics-block-title">Flashcard mastery</div>
            <div id="analyticsMasterySummary" class="analytics-mastery-summary"></div>
            <div id="analyticsFlashcardsList" class="analytics-flashcards-list"></div>
          </div>
        </div>
      </section>
    </aside>

    <main class="d-flex flex-column p-0 chat-main">
      <div id="messages" class="flex-grow-1 overflow-auto p-4"></div>

      <form id="chatForm" class="p-3 border-top bg-white">
        <div class="input-group">
          <input id="messageInput" class="form-control" placeholder="Type your message..." />
          <button class="btn btn-primary" id="sendBtn">Send</button>
          <button class="btn btn-outline-secondary" id="viewFlashcardsBtn" type="button" disabled>View all flashcards</button>
        </div>
        <div id="flashcardStatus" class="small text-muted mt-2"></div>
      </form>
    </main>

    <aside id="flashcardsPanel" class="app-flashcards-panel border-start p-3 d-none">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="h6 mb-0">Flashcards</h2>
        <button id="closeFlashcardsBtn" class="btn btn-sm btn-outline-secondary" type="button">Close</button>
      </div>

      <div id="flashcardsStudyView">
        <div id="flashcardsCounter" class="small text-muted mb-2">0 / 0</div>

        <div id="flashcardsCardBox" class="flashcard border rounded-4 p-4">
          <div id="flashcardsSideLabel" class="small text-muted mb-2">Question</div>
          <div id="flashcardsCardText" class="fs-6" style="white-space: pre-wrap;"></div>
        </div>

        <div class="d-flex justify-content-between mt-3">
          <button id="flashcardsPrevBtn" class="btn btn-outline-primary" type="button">Previous</button>
          <button id="flashcardsFlipBtn" class="btn btn-primary" type="button">Flip</button>
          <button id="flashcardsNextBtn" class="btn btn-outline-primary" type="button">Next</button>
        </div>

        <div class="d-flex justify-content-center mt-3">
          <button id="startQuizBtn" class="btn btn-success" type="button">Start MCQ quiz</button>
        </div>

        <div class="small text-muted mt-3">
          Tips: Left/Right to navigate, Space to flip
        </div>
      </div>

      <div id="flashcardsQuizView" class="d-none">
        <div id="quizProgress" class="small text-muted mb-2">Question 0 / 0</div>

        <div class="flashcard border rounded-4 p-4">
          <div class="small text-muted mb-2">Question</div>
          <div id="quizQuestionText" class="fs-6" style="white-space: pre-wrap;"></div>
        </div>

        <div id="quizOptions" class="d-grid gap-2 mt-3"></div>

        <div id="quizFeedback" class="small mt-3"></div>

        <div id="quizSummary" class="border rounded-3 p-3 mt-3 d-none"></div>

        <div class="d-flex justify-content-between mt-3">
          <button id="quizBackBtn" class="btn btn-outline-secondary" type="button">Back to flashcards</button>
          <button id="quizNextBtn" class="btn btn-primary" type="button" disabled>Next</button>
        </div>
      </div>
    </aside>

  </div>
</div>

<script>
  (function () {
    var v = window.__ssiAssetVersion || String(Date.now());
    var scripts = [
      "../js/api.js",
      "../js/auth.js",
      "../js/i18n.js",
      "../js/theme.js",
      "../js/chat.js",
      "../js/dev-hot-reload.js"
    ];

    function loadScript(index) {
      if (index >= scripts.length) return;
      var script = document.createElement("script");
      script.src = scripts[index] + "?v=" + encodeURIComponent(v);
      script.onload = function () { loadScript(index + 1); };
      script.onerror = function () { loadScript(index + 1); };
      document.body.appendChild(script);
    }

    loadScript(0);
  })();
</script>
</body>
</html>
